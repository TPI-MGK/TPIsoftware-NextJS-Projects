# 第 10 章：伺服器與客戶端元件

要了解伺服器和客戶端元件如何運作，熟悉兩個基礎的 Web 概念會很有幫助：

- 您的應用程式程式碼可以執行的**環境**：**伺服器**和**客戶端**。
- 分隔伺服器和客戶端程式碼的**網路邊界**。

## 伺服器與客戶端環境

在 Web 應用程式的上下文中：

![](https://nextjs.org/_next/image?url=https%3A%2F%2Fh8DxKfmAPhn8O0p3.public.blob.vercel-storage.com%2Flearn%2Fdark%2Flearn-client-and-server-environments.png&w=3840&q=75)

- **客戶端 (Client)** 指的是使用者裝置上的瀏覽器，它向伺服器發送請求以取得您的應用程式程式碼。然後，它將從伺服器收到的回應轉變為使用者可以互動的介面。
- **伺服器 (Server)** 指的是資料中心中的電腦，它儲存您的應用程式程式碼、接收來自客戶端的請求、進行一些計算，並回傳適當的回應。

每個環境都有其自己的一套能力和限制。例如，透過將渲染和資料獲取移至伺服器，您可以減少傳送到客戶端的程式碼量，這可以提高應用程式的效能。但是，正如您先前所學，為了讓您的 UI 具有互動性，您需要在客戶端上更新 DOM。
因此，您為伺服器和客戶端編寫的程式碼不總是一樣的。某些操作（例如資料獲取或管理使用者狀態）更適合在某個環境中執行。

## 網路邊界

**網路邊界 (Network Boundary)** 是一條分隔不同環境的概念性線條。
在 React 中，您可以選擇在元件樹中放置網路邊界的位置。例如，您可以在伺服器上獲取資料並渲染使用者的貼文（使用**伺服器元件**），然後在客戶端上為每個貼文渲染互動式的 `LikeButton`（使用**客戶端元件**）。
同樣地，您可以建立一個在伺服器上渲染並在各個頁面間共享的 `Nav` 元件，但如果您想為連結顯示活動狀態，您可以在客戶端上渲染 `Links` 列表。

![](https://nextjs.org/_next/image?url=https%3A%2F%2Fh8DxKfmAPhn8O0p3.public.blob.vercel-storage.com%2Flearn%2Fdark%2Flearn-client-server-modules.png&w=3840&q=75)

在幕後，元件被分成兩個模組圖。**伺服器模組圖**（或樹）包含所有在伺服器上渲染的伺服器元件，而**客戶端模組圖**（或樹）包含所有客戶端元件。
在伺服器元件渲染完畢後，一種稱為 **React 伺服器元件酬載 (RSC)** 的特殊資料格式會被傳送到客戶端。RSC 酬載包含：

- 伺服器元件的渲染結果。
- 客戶端元件應該被渲染的位置的佔位符（或空洞）以及對其 JavaScript 檔案的引用。
  React 使用這些資訊來整合伺服器和客戶端元件，並在客戶端上更新 DOM。
  讓我們看看這是如何運作的。

## 使用客戶端元件

正如您在上一章所學，Next.js 預設使用**伺服器元件**——這是為了提高應用程式的效能，也意味著您不需要採取額外的步驟來採用它們。
回頭看您瀏覽器中的錯誤，Next.js 警告您正試圖在伺服器元件中使用 `useState`。您可以透過將互動式的「喜歡」按鈕移至**客戶端元件**來解決此問題。
在 `app` 資料夾內建立一個名為 `like-button.js` 的新檔案，並匯出一個 `LikeButton` 元件：

**/app/like-button.js**

```javascript
export default function LikeButton() {}
```

將 `<button>` 元素和 `handleClick()` 函式從 `page.js` 移到您的新 `LikeButton` 元件：
**/app/like-button.js**

```javascript
export default function LikeButton() {
  function handleClick() {
    setLikes(likes + 1);
  }

  return <button onClick={handleClick}>Like ({likes})</button>;
}
```

接下來，移動 `likes` 狀態和匯入：

**/app/like-button.js**

```javascript
import { useState } from "react";

export default function LikeButton() {
  const [likes, setLikes] = useState(0);

  function handleClick() {
    setLikes(likes + 1);
  }

  return <button onClick={handleClick}>Like ({likes})</button>;
}
```

現在，要讓 `LikeButton` 成為一個客戶端元件，請在檔案頂部加上 React 的 `'use client'` 指令。這告訴 React 在客戶端上渲染該元件。

**/app/like-button.js**

```javascript
"use client";

import { useState } from "react";

export default function LikeButton() {
  const [likes, setLikes] = useState(0);

  function handleClick() {
    setLikes(likes + 1);
  }

  return <button onClick={handleClick}>Like ({likes})</button>;
}
```

回到您的 `page.js` 檔案，將 `LikeButton` 元件匯入您的頁面：

**/app/page.js**

```javascript
import LikeButton from "./like-button";

function Header({ title }) {
  return <h1>{title ? title : "Default title"}</h1>;
}

export default function HomePage() {
  const names = ["Ada Lovelace", "Grace Hopper", "Margaret Hamilton"];

  return (
    <div>
      <Header title="Develop. Preview. Ship." />
      <ul>
        {names.map((name) => (
          <li key={name}>{name}</li>
        ))}
      </ul>
      <LikeButton />
    </div>
  );
}
```

儲存這兩個檔案並在瀏覽器中查看您的應用程式。現在沒有錯誤了，一旦您進行更改並儲存，您應該會注意到瀏覽器會自動更新以反映變更。
這個功能稱為**快速刷新 (Fast Refresh)**。它為您所做的任何編輯提供即時回饋，並且已與 Next.js 預先配置。

## 總結

總結一下，您學到了伺服器和客戶端環境，以及何時使用它們。您還學到 Next.js 預設使用 React 伺服器元件來提高效能，以及如何選擇性地使用客戶端元件來讓 UI 的一小部分具有互動性。

## 額外閱讀

關於伺服器和客戶端元件還有很多可以學習的。這裡有一些額外資源：

- [伺服器元件文件](https://nextjs.org/docs/app/building-your-application/rendering/server-components)
- [客戶端元件文件](https://nextjs.org/docs/app/building-your-application/rendering/client-components)
- [組合模式](https://nextjs.org/docs/app/building-your-application/rendering/composition-patterns)
- ["use client" 指令](https://react.dev/reference/react/use-client)
- ["use server" 指令](https://react.dev/reference/react/use-server)
