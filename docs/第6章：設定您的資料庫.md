# 第六章：設定您的資料庫

在繼續開發您的儀表板之前，您需要一些資料。在本章中，您將從 Vercel 的一個市集整合服務中設定一個 PostgreSQL 資料庫。如果您已經熟悉 PostgreSQL 並希望使用自己的資料庫提供商，您可以跳過本章並自行設定。否則，讓我們繼續！

## 在本章中...

以下是我們將涵蓋的主題：

-   將您的專案推送到 GitHub。
-   設定 Vercel 帳戶並連結您的 GitHub 儲存庫，以便即時預覽和部署。
-   建立您的專案並將其連結到一個 Postgres 資料庫。
-   使用初始資料填充資料庫 (Seed the database)。

## 建立 GitHub 儲存庫

首先，如果您尚未將儲存庫推送到 GitHub，請執行此操作。這將使設定資料庫和部署變得更加容易。

如果您在設定儲存庫時需要協助，請參閱 [GitHub 上的這份指南](https://docs.github.com/en/get-started/importing-your-projects-to-github/importing-a-repository-with-github-desktop)。

**值得注意的是：**

-   您也可以使用其他 Git 提供商，例如 GitLab 或 Bitbucket。
-   如果您不熟悉 GitHub，我們推薦使用 [GitHub Desktop App](https://desktop.github.com/) 來簡化開發工作流程。

## 建立 Vercel 帳戶

請訪問 [vercel.com/signup](https://vercel.com/signup) 建立帳戶。選擇免費的「Hobby」方案。選擇「Continue with GitHub」以連接您的 GitHub 和 Vercel 帳戶。

## 連接並部署您的專案

接下來，您將會看到這個畫面，您可以在此選擇並匯入您剛剛建立的 GitHub 儲存庫：

![匯入 Git 儲存庫](https://nextjs.org/_next/image?url=https%3A%2F%2Fh8DxKfmAPhn8O0p3.public.blob.vercel-storage.com%2Flearn%2Fdark%2Fimport-git-repo.png&w=1920&q=75)

為您的專案命名並點擊「Deploy」。

![配置專案](https://nextjs.org/_next/image?url=https%3A%2F%2Fh8DxKfmAPhn8O0p3.public.blob.vercel-storage.com%2Flearn%2Fdark%2Fconfigure-project.png&w=1920&q=75)

太棒了！🎉 您的專案現在已部署完成。

![已部署的專案](https://nextjs.org/_next/image?url=https%3A%2F%2Fh8DxKfmAPhn8O0p3.public.blob.vercel-storage.com%2Flearn%2Fdark%2Fdeployed-project.png&w=1920&q=75)

*專案概覽畫面，顯示專案名稱、網域和部署狀態。*

透過連接您的 GitHub 儲存庫，每當您將變更推送到您的主要分支 (main branch) 時，Vercel 將自動重新部署您的應用程式，無需任何額外配置。當您開啟拉取請求 (pull requests) 時，您還會獲得即時的預覽 URL，這讓您能夠及早發現部署錯誤，並與團隊成員分享專案預覽以獲取回饋。

## 建立 Postgres 資料庫

接下來，要設定資料庫，請點擊「Continue to Dashboard」，然後從您的專案儀表板中選擇「Storage」選項卡。選擇「Create Database」。根據您的 Vercel 帳戶創建時間，您可能會看到 Neon 或 Supabase 等選項。選擇您偏好的提供商，然後點擊「Continue」。

![建立資料庫](https://nextjs.org/_next/image?url=https%3A%2F%2Fh8DxKfmAPhn8O0p3.public.blob.vercel-storage.com%2Flearn%2Fdark%2Fcreate-database.png&w=1920&q=75)

如果需要，請選擇您的區域和儲存方案。所有 Vercel 專案的預設區域是華盛頓特區 (Washington D.C. - iad1)，如果可用，我們建議選擇此區域以減少資料請求的延遲。

![資料庫區域](https://nextjs.org/_next/image?url=https%3A%2F%2Fh8DxKfmAPhn8O0p3.public.blob.vercel-storage.com%2Flearn%2Fdark%2Fdatabase-region.png&w=1920&q=75)

連接後，導航到 `.env.local` 選項卡，點擊「Show secret」並「Copy Snippet」。**請確保在複製之前顯示密鑰。**

![資料庫儀表板](https://nextjs.org/_next/image?url=https%3A%2F%2Fh8DxKfmAPhn8O0p3.public.blob.vercel-storage.com%2Flearn%2Fdark%2Fdatabase-dashboard.png&w=1920&q=75)

導航到您的程式碼編輯器，並將 `.env.example` 檔案重新命名為 `.env`。貼上從 Vercel 複製的內容。

**重要提示**：請前往您的 `.gitignore` 檔案，並確保 `.env` 在被忽略的檔案中，以防止當您推送到 GitHub 時，您的資料庫密鑰被暴露。

## 填充您的資料庫 (Seed Your Database)

現在您的資料庫已建立，讓我們用一些初始資料來填充它。

我們提供了一個您可以在瀏覽器中存取的 API，它將運行一個填充腳本，用初始資料集來填充資料庫。該腳本使用 SQL 來建立表格，並在表格建立後，使用來自 `placeholder-data.ts` 檔案的資料來填充它們。

請確保您的本地開發伺服器正在運行 (`pnpm run dev`)，然後在瀏覽器中導航到 `localhost:3000/seed`。完成後，您將在瀏覽器中看到訊息「Database seeded successfully」。完成後，您可以刪除此檔案。

**疑難排解：**

-   請確保在將資料庫密鑰複製到您的 `.env` 檔案之前顯示它。
-   該腳本使用 `bcrypt` 來雜湊使用者的密碼。如果 `bcrypt` 與您的環境不相容，您可以將腳本更新為使用 `bcryptjs`。
-   如果您在填充資料庫時遇到任何問題，並且想要再次運行腳本，您可以透過在資料庫查詢介面中運行 `DROP TABLE tablename` 來刪除任何現有的表格。有關更多詳細資訊，請參閱下面的執行查詢部分。但請務必小心，此指令將刪除表格及其所有資料。在您的範例應用程式中使用此操作是可以的，因為您正在處理佔位符資料，但您不應該在生產應用程式中運行此指令。

## 執行查詢

讓我們執行一個查詢以確保一切都按預期工作。我們將使用另一個路由處理器 (Router Handler)，`app/query/route.ts`，來查詢資料庫。在這個檔案中，您將找到一個 `listInvoices()` 函數，它包含以下 SQL 查詢。

```sql
SELECT invoices.amount, customers.name
FROM invoices
JOIN customers ON invoices.customer_id = customers.id
WHERE invoices.amount = 666;
```

取消該檔案的註解，移除 `Response.json()` 區塊，然後在瀏覽器中導航到 `localhost:3000/query`。您應該會看到返回的發票金額和客戶名稱。
```
