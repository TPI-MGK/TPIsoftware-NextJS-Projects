# 第三章：優化字體與圖片

在上一章中，您學習了如何為您的 Next.js 應用程式設定樣式。現在讓我們繼續完善您的首頁，為其添加自訂字體和主視覺圖片。

## 在本章中...

以下是我們將涵蓋的主題：

- 如何使用 `next/font` 添加自訂字體。
- 如何使用 `next/image` 添加圖片。
- Next.js 如何優化字體和圖片。

## 為何要優化字體？

字體在網站設計中扮演著重要角色，但在專案中使用自訂字體可能會影響效能，因為需要獲取並載入字體檔案。

**累計版面配置位移 (Cumulative Layout Shift, CLS)** 是 Google 用於評估網站效能和使用者體驗的一個指標。對於字體而言，當瀏覽器最初使用備用字體或系統字體渲染文字，然後在自訂字體載入後再進行替換時，就會發生版面配置位移。這種替換可能導致文字大小、間距或佈局發生變化，從而使其周圍的元素發生位移。

_模擬 UI 顯示頁面初始載入後，隨著自訂字體載入而發生版面配置位移的情況。_

當您使用 `next/font` 模組時，Next.js 會自動優化應用程式中的字體。它會在建置時下載字體檔案，並將其與您的其他靜態資產一同託管。這意味著當使用者訪問您的應用程式時，不會有額外的字體網路請求影響效能。

## 添加主要字體

讓我們在您的應用程式中添加一個自訂的 Google 字體，來看看這是如何運作的。

1.  在您的 `/app/ui` 資料夾中，建立一個名為 `fonts.ts` 的新檔案。您將用此檔案來管理整個應用程式中使用的字體。

2.  從 `next/font/google` 模組匯入 `Inter` 字體——這將是您的主要字體。然後，指定您想要載入的子集（subset）。在此案例中，我們使用 `'latin'`：

    `/app/ui/fonts.ts`

    ```ts
    import { Inter } from "next/font/google";

    export const inter = Inter({ subsets: ["latin"] });
    ```

3.  最後，將字體添加到 `/app/layout.tsx` 中的 `<body>` 元素上：

    `/app/layout.tsx`

    ```tsx
    import "@/app/ui/global.css";
    import { inter } from "@/app/ui/fonts";

    export default function RootLayout({
      children,
    }: {
      children: React.ReactNode;
    }) {
      return (
        <html lang="en">
          <body className={`${inter.className} antialiased`}>{children}</body>
        </html>
      );
    }
    ```

透過將 `Inter` 字體添加到 `<body>` 元素，該字體將應用於您的整個應用程式。在這裡，您還添加了 Tailwind 的 `antialiased` class，它可以使字體顯示更平滑。這不是必須的，但能增添一些細緻的美感。

現在，前往您的瀏覽器，打開開發者工具並選取 `body` 元素。您應該會在樣式中看到 `Inter` 和 `Inter_Fallback` 現在已被應用。

## 練習：添加次要字體

您也可以將字體應用於應用程式的特定元素。

現在輪到您了！在您的 `fonts.ts` 檔案中，匯入一個名為 `Lusitana` 的次要字體，並將其應用於 `/app/page.tsx` 檔案中的 `<p>` 元素。除了像之前一樣指定 `subsets`，您還應該指定不同的字體粗細（font weights）。例如，`400`（正常）和 `700`（粗體）。

準備好後，可以展開下面的程式碼片段查看解決方案。

**提示：**

- 如果您不確定要為字體傳遞哪些 `weight` 選項，請檢查您程式碼編輯器中的 TypeScript 錯誤提示。
- 訪問 [Google Fonts](https://fonts.google.com/) 網站並搜尋 `Lusitana`，查看有哪些可用選項。
- 參閱 Next.js 文件中關於[添加多個字體](https://nextjs.org/docs/app/building-your-application/optimizing/fonts#with-multiple-fonts)的說明。

<details>
<summary>點此展開解決方案</summary>

`/app/ui/fonts.ts`

```ts
import { Inter, Lusitana } from "next/font/google";

export const inter = Inter({ subsets: ["latin"] });

export const lusitana = Lusitana({
  weight: ["400", "700"],
  subsets: ["latin"],
});
```

`/app/page.tsx`

```tsx
import AcmeLogo from "@/app/ui/acme-logo";
import { ArrowRightIcon } from "@heroicons/react/24/outline";
import Link from "next/link";
import { lusitana } from "@/app/ui/fonts";

export default function Page() {
  return (
    // ...
    <p
      className={`${lusitana.className} text-xl text-gray-800 md:text-3xl md:leading-normal`}
    >
      <strong>Welcome to Acme.</strong> This is the example for the{" "}
      <a href="https://nextjs.org/learn/" className="text-blue-500">
        Next.js Learn Course
      </a>
      , brought to you by Vercel.
    </p>
    // ...
  );
}
```

</details>

最後，`<AcmeLogo />` 元件也使用了 `Lusitana` 字體。它之前被註解掉了以防止錯誤，您現在可以取消註解它：

`/app/page.tsx`

```tsx
// ...
export default function Page() {
  return (
    <main className="flex min-h-screen flex-col p-6">
      <div className="flex h-20 shrink-0 items-end rounded-lg bg-blue-500 p-4 md:h-52">
        <AcmeLogo />
        {/* ... */}
      </div>
    </main>
  );
}
```

太棒了！您已經為您的應用程式添加了兩種自訂字體。接下來，讓我們為首頁添加一張主視覺圖片。

## 為何要優化圖片？

Next.js 可以在頂層的 `/public` 資料夾下提供靜態資產，如圖片。在 `/public` 內的檔案可以在您的應用程式中被引用。

使用常規的 HTML，您可以這樣添加圖片：

```html
<img src="/hero.png" alt="儀表板專案的螢幕截圖，顯示桌面版本" />
```

然而，這意味著您必須手動處理：

- 確保您的圖片在不同螢幕尺寸上具有響應性。
- 為不同設備指定圖片尺寸。
- 防止圖片載入時發生版面配置位移。
- 對使用者可視範圍之外的圖片進行延遲載入 (Lazy loading)。

圖片優化是網頁開發中的一個大主題，甚至可以被視為一門專業。與其手動實現這些優化，您可以使用 `next/image` 元件來自動優化您的圖片。

## `<Image>` 元件

`<Image>` 元件是 HTML `<img>` 標籤的擴展，並內建了自動圖片優化功能，例如：

- **防止版面配置位移**：在圖片載入時自動防止版面配置位移。
- **調整圖片大小**：避免向具有較小可視範圍的設備傳送大尺寸圖片。
- **延遲載入**：預設情況下，圖片在進入可視範圍時才載入。
- **現代格式提供**：當瀏覽器支援時，以 WebP 和 AVIF 等現代格式提供圖片。

## 添加桌面版主視覺圖片

讓我們來使用 `<Image>` 元件。如果您查看 `/public` 資料夾，您會看到有兩張圖片：`hero-desktop.png` 和 `hero-mobile.png`。這兩張圖片完全不同，將根據使用者的設備是桌面還是行動裝置來顯示。

在您的 `/app/page.tsx` 檔案中，從 `next/image` 匯入該元件。然後，在註解下方添加圖片：
`/app/page.tsx`

```tsx
import AcmeLogo from "@/app/ui/acme-logo";
import { ArrowRightIcon } from "@heroicons/react/24/outline";
import Link from "next/link";
import { lusitana } from "@/app/ui/fonts";
import Image from "next/image";

export default function Page() {
  return (
    // ...
    <div className="flex items-center justify-center p-6 md:w-3/5 md:px-28 md:py-12">
      {/* Add Hero Images Here */}
      <Image
        src="/hero-desktop.png"
        width={1000}
        height={760}
        className="hidden md:block"
        alt="儀表板專案的螢幕截圖，顯示桌面版本"
      />
    </div>
    //...
  );
}
```

在這裡，您將 `width` 設為 `1000`，`height` 設為 `760` 像素。為您的圖片設定寬度和高度以避免版面配置位移是一個好習慣，這些值應與來源圖片的長寬比相同。

您還會注意到 `hidden` class 用於在行動裝置螢幕上從 DOM 中移除圖片，而 `md:block` 則用於在桌面螢幕上顯示圖片。

## 練習：添加行動版主視覺圖片

現在輪到您了！在您剛才添加的圖片下方，為 `hero-mobile.png` 添加另一個 `<Image>` 元件。

- 圖片的寬度應為 `560`，高度為 `620` 像素。
- 它應該在行動裝置螢幕上顯示，並在桌面上隱藏。您可以使用開發者工具來檢查桌面和行動版圖片是否正確切換。

準備好後，可以展開下面的程式碼片段查看解決方案。

<details>
<summary>點此展開解決方案</summary>

`/app/page.tsx`

```tsx
import AcmeLogo from "@/app/ui/acme-logo";
import { ArrowRightIcon } from "@heroicons/react/24/outline";
import Link from "next/link";
import { lusitana } from "@/app/ui/fonts";
import Image from "next/image";

export default function Page() {
  return (
    // ...
    <div className="flex items-center justify-center p-6 md:w-3/5 md:px-28 md:py-12">
      {/* Add Hero Images Here */}
      <Image
        src="/hero-desktop.png"
        width={1000}
        height={760}
        className="hidden md:block"
        alt="儀表板專案的螢幕截圖，顯示桌面版本"
      />
      <Image
        src="/hero-mobile.png"
        width={560}
        height={620}
        className="block md:hidden"
        alt="儀表板專案的螢幕截圖，顯示行動版本"
      />
    </div>
    //...
  );
}
```

</details>

太棒了！您的首頁現在有了自訂字體和主視覺圖片。

## 推薦閱讀

關於這些主題還有很多可以學習，包括優化遠端圖片和使用本地字體檔案。如果您想深入了解字體和圖片，請參閱：

- [圖片優化文件 (Next.js)](https://nextjs.org/docs/app/building-your-application/optimizing/images)
- [字體優化文件 (Next.js)](https://nextjs.org/docs/app/building-your-application/optimizing/fonts)
- [透過圖片改善網頁效能 (MDN)](https://developer.mozilla.org/en-US/docs/Web/Performance/Fundamentals)
- [網頁字體 (MDN)](https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Fonts)

```

```
